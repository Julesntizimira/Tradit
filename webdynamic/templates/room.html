{% extends 'dashboard.html' %}
{% block container %}
<div class="dashboard-container" style="position: fixed; width: 100%; height: 100%; margin: 0; margin-top: 80px;">
    <div class="dashboard-transparant">
        <div class="user-profile">
            <div class="user-profile-infos">
                <div class="user-profile-pic">
                    <img src="../static/profiles/jules.JPG" alt="">
                </div>
                <div class="profile-infos">
                    <div class="profile-name">Ntizimira Mutsinzi Jules</div>
                    <div class="address">Kigali - Rwanda</div>
                    <div class="user-books"></div>
                </div>
            </div>


            <div class="message-box">
                <h2>Chat Room: {{ receiver|title }}</h2>
                <div class="messages"></div>
                <div class="inputs">
                    <input type="text" placeholder="Type something" class="input-msg">
                    <button class="send-btn" onclick="SendMessage()">SEND</button>
                </div>
            </div>
        </div>
        
    </div>
</div>


<script type="text/javascript">
    const socket = io();
    socket.on('message', (data) => {
        if (data.msg === 'clean') {
            document.querySelector('.messages').innerHTML = "";
        } else {
            CreateMessage(data);
        }
    })
    function CreateMessage(data) {
        const p = document.createElement('p');
        const d = document.createElement('div');

        const span_msg = document.createElement('span')
        span_msg.innerHTML = `${data.message}`

        const span_username = document.createElement('span')
        span_username.innerHTML = `${data.name}`

        p.innerHTML = span_msg.outerHTML;
        p.classList.add('msg')
        if (data.name === '{{ name }}') {
            d.classList.add('sent-message-div')
            p.classList.add('sent-message-p')

        } else {
            d.classList.add('received-message-div')
            p.classList.add('received-message-p') 
        }
        d.append(p);
        document.querySelector('.messages').append(d);
    }
    function SendMessage() {
        const msg = document.querySelector('.input-msg').value;
        if (msg === '') {
            return;
        }
        socket.send({'data': msg});
        document.querySelector('.input-msg').value = '';
    }
    for (let msg of store) {
        CreateMessage(msg);
    }
</script>

{% endblock %}
